<!-- The Modal -->
<div class="modal fade" id="uploadImagePost" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Upload Image Post</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">

                <div class="image-upload">
                    <div>
                        <div style="float: left; margin-right: 20px;">
                            <label for="file-input-post">
                                <img src="/images/default_image.png" width="110px" id="image-post"
                                    style="cursor: pointer" />
                            </label>
                        </div>
                        <div style="margin-top: 20px; height: 100px;">
                            Tạo bài giảng thành công !!! Upload hình ảnh để minh họa cho bài giảng !!! Nếu không cần thì hãy nhấp hủy !!!
                        </div>
                    </div>
                    <input id="file-input-post" type="file" />
                    <div class="progress d-none" id="progress-parrent-post">
                        <div class="progress-bar" role="progressbar" id="progress-post" aria-valuenow="25"
                            aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>


                <div class="modal-footer">
                    <button id="closemodal" type="button" class="btn btn-danger">Close</button>
                    <a onclick="goPost()" class="btn btn-primary">Save</a>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    var BASE_URL = '<%- BASE_URL %>';
    var POST_UPLOAD_IMAGE_POST = '<%- POST_UPLOAD_IMAGE_POST %>'
    var POST_ID = '<%- idPost %>';
    var token = '<%- token %>';

    function goPost(){
        window.location = "/admin/post";
    }

    async function readURL(input) {
        $("#progress-parrent-post").removeClass("d-none");
        $("#progress-post").width("0%");


        if (input.files && input.files[0]) {
            var reader = new FileReader();
            console.log("aa");
            reader.onload = function (e) {
                $('#image-post').attr('src', e.target.result);
            }

            reader.readAsDataURL(input.files[0]); // convert to base64 string

            reader.onloadend = function (e) {
                // base64 = e.target.result;
                // console.log(base64);
                // console.log(base64.split(',')[1]);
                var formData = new FormData();
                formData.append("avatar", input.files[0]);
                options = {
                    headers:
                        { Authorization: "Bearer " + token, 'Content-Type': 'multipart/form-data' },
                    onUploadProgress: progressEvent => {
                        let percentCompleted = Math.floor((progressEvent.loaded * 100) / progressEvent.total);
                        $("#progress-post").width(percentCompleted + "%");
                    }
                };

                axios.post(BASE_URL + POST_UPLOAD_IMAGE_POST + "/" + POST_ID, formData, options)
                    .then(function (response) {
                        console.log("Success");
                        $("#progress-parrent-post").addClass("d-none");
                    })
                    .catch(function (error) {
                        console.log(error);
                        $("#progress-parrent-post").addClass("d-none");
                    });
            };

        }

    }

    $("#file-input-post").change(function () {
        readURL(this);
    });
</script>